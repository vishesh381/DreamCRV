import chokidar from 'chokidar';
import { debounce, isLocalDev } from '@lwrjs/shared-utils';
import { logger } from '@lwrjs/diagnostics';
/**
 * Factory comptable with the LWR Runtime to create a file watch library for LWR dev server.
 * When importing this module make sure the optional library 'chokidar' is installed.
 */
export class WatcherFactoryImpl {
    /**
     * Set up a watcher with the given options
     * @param options
     */
    createFileWatcher(options) {
        if (!options) {
            options = { persistent: true };
            // Don't exclude node modules during local dev for MRT
            // TODO find a better solution for this
            if (!isLocalDev())
                options.ignored = '**/node_modules/**';
        }
        return chokidar.watch([], options);
    }
    /**
     * Set up file watcher
     */
    setupWatcher(onModuleChange) {
        const fileWatcher = this.createFileWatcher();
        fileWatcher.on('change', debounce((file) => onModuleChange(file), 500));
        fileWatcher.on('unlink', debounce((file) => onModuleChange(file), 500));
        fileWatcher.on('add', (file) => logger.info({ label: `fs-watch`, message: `Watching: ${file}` }));
        return fileWatcher;
    }
}
//# sourceMappingURL=index.js.map