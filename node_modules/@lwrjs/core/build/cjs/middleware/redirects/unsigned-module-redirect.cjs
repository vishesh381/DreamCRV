var __defProp = Object.defineProperty;
var __markAsModule = (target) => __defProp(target, "__esModule", {value: true});
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, {get: all[name], enumerable: true});
};

// packages/@lwrjs/core/src/middleware/redirects/unsigned-module-redirect.ts
__markAsModule(exports);
__export(exports, {
  createUnsignedBundleRedirect: () => createUnsignedBundleRedirect,
  createUnsignedModuleRedirect: () => createUnsignedModuleRedirect
});
var HEADER_LOCATION = "Location";
var STATUS_FOUND = 302;
function createUnsignedModuleRedirect(moduleRegistry) {
  return async (req, res, moduleId, runtimeEnvironment, runtimeParams) => {
    const jsonQuery = getJsonQualifier(req, runtimeEnvironment);
    const {moduleEntry, ownHash} = await moduleRegistry.getModule(moduleId, runtimeParams);
    const uri = await moduleRegistry.resolveModuleUri({...moduleId, version: moduleEntry.version}, runtimeEnvironment, runtimeParams, ownHash);
    sendRedirect(res, `${uri}${jsonQuery}`);
  };
}
function createUnsignedBundleRedirect(moduleBundler) {
  return async (req, res, moduleId, runtimeEnvironment, runtimeParams) => {
    const jsonQuery = getJsonQualifier(req, runtimeEnvironment);
    const uri = await moduleBundler.resolveModuleUri(moduleId, runtimeEnvironment, runtimeParams);
    sendRedirect(res, `${uri}${jsonQuery}`);
  };
}
function getJsonQualifier(req, runtimeEnvironment) {
  return req.isJsonRequest() ? `${runtimeEnvironment.debug ? "&" : "?"}json` : "";
}
function sendRedirect(res, url) {
  res.setHeader(HEADER_LOCATION, url);
  res.sendStatus(STATUS_FOUND);
}
