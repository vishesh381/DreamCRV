const HEADER_LOCATION = 'Location';
const STATUS_FOUND = 302;
export function createUnsignedModuleRedirect(moduleRegistry) {
    return async (req, res, moduleId, runtimeEnvironment, runtimeParams) => {
        const jsonQuery = getJsonQualifier(req, runtimeEnvironment);
        const { moduleEntry, ownHash } = await moduleRegistry.getModule(moduleId, runtimeParams);
        const uri = await moduleRegistry.resolveModuleUri({ ...moduleId, version: moduleEntry.version }, runtimeEnvironment, runtimeParams, ownHash);
        sendRedirect(res, `${uri}${jsonQuery}`);
    };
}
export function createUnsignedBundleRedirect(moduleBundler) {
    return async (req, res, moduleId, runtimeEnvironment, runtimeParams) => {
        const jsonQuery = getJsonQualifier(req, runtimeEnvironment);
        const uri = await moduleBundler.resolveModuleUri(moduleId, runtimeEnvironment, runtimeParams);
        sendRedirect(res, `${uri}${jsonQuery}`);
    };
}
function getJsonQualifier(req, runtimeEnvironment) {
    return req.isJsonRequest() ? `${runtimeEnvironment.debug ? '&' : '?'}json` : '';
}
function sendRedirect(res, url) {
    res.setHeader(HEADER_LOCATION, url);
    res.sendStatus(STATUS_FOUND);
}
//# sourceMappingURL=unsigned-module-redirect.js.map