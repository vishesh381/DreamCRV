import path from 'path';
import NormalizeRoutesStartHook from './normalize-routes-hook.js';
import { crossEnvFileURL } from '@lwrjs/shared-utils';
/**
 * Configuration that runs during the experimental-mrt-dev command to setup CLWR hooks. Configures the
 * runtimeEnvironmentto reference the dev/* files in the MRT bundle and setup HMR / file watchers.
 */
export default class DevStartHook {
    async setupServerContext(context, startHooks) {
        const { MRT_APP_CONFIG } = await import(crossEnvFileURL(path.join(process.cwd(), process.env.MRT_BUNDLE_ROOT ?? 'app', 'ssr.js')));
        Object.assign(context.routeHandlers, MRT_APP_CONFIG.routeHandlers);
        startHooks.push(...MRT_APP_CONFIG.hooks);
        startHooks.push(new NormalizeRoutesStartHook());
        // Enable debug bundles and HMR when running local dev
        context.runtimeEnvironment.debug = true;
        context.runtimeEnvironment.watchFiles = true;
        context.runtimeEnvironment.hmrEnabled = true;
    }
}
//# sourceMappingURL=dev-context-hook.js.map